<?php

/**
 * @file
 * Tests for the home page.
 */

/**
 * Tests menu links depending on user permissions.
 */
class Home_Default_Unregistered_TestCase extends FirstRemoteTestCase {
  public static function getInfo() {
    return array(
      'name' => 'Home Default Unregistered Test',
      'description' => 'Tests Home Default page when not logged in',
      'group' => 'iWheat',
    );
  }

  function setUp() {
    parent::setUp(array('node'));
  }

  /**
   * Test that the links are added to the page (no JS testing).
   */
  function testHomePageContent() {
    module_enable(array('contact'));
    $this->resetAll();

    // Anonymous users should not see the menu.
    $this->drupalGet('');

    // Check that the field appears in the overview form.
    $this->assertFieldByXPath('//h1[@id="page-title"]', 'Welcome to iWheat.org!', 'Page title string found...');
    
    $base_path = '//div[@id="block-system-main"]//div[@class="block-inner clearfix"]//div[@class="content clearfix"]//article[@id="node-page-1"]//div[@class="content clearfix"]//div[@class="field field-name-body field-type-text-with-summary field-label-hidden"]//div[@class="field-items"]//div[@class="field-item even"]//';
    
    // Check that the intro paragraph appears
    $this->assertFieldByXPath($base_path . 'p', 'Watch a 2 minute video to learn how to use this site:', '1st paragraph found');
    
    // Check that the intro video appears
    $this->assertElementByXPath($base_path . 'p//iframe[@src="http://www.youtube.com/embed/OmneHmwHLyE"]', array(), 'Video found');
    
    // Check that the 2nd paragraph appears
    $this->assertFieldByXPath($base_path . 'p', 'We will provide you with news and progress on desktop modules, smartphone apps, and other developments as soon as information is available. Please be patient with us, this is a work in progress!', '2nd paragraph found');
    
    // Check that the 3rd paragraph, part 1 appears
    // @note
    // Do not add trailing blank as this is not a blank in the html (at least
    // for this string; need to see how the html is generated; the blank may be
    // a &nbsp; character).
    // For assertFieldByXPath() you would need to match everything inside the
    // 'field' specified. In the next assert, the field is the <p> tag and its
    // contents includes the node/10 link tested below.
    $this->assertText('To learn more about iWheat and how you can get involved, visit the', '3rd paragraph part 1 found');
    
    // Check that the Project Overview link in the 3rd paragraph appears correctly
    $this->assertFieldByXPath($base_path . 'p//a[@href="/node/10"]', 'Project Overview', 'Project Overview link found');
    
    // Check that the 3rd paragraph, part 2 appears
    $this->assertText('sections of the site.', '3rd paragraph part 2 found');

    
return;
  }
}
