<?php
/**
As a developer, I want a regression test to prove that the fields and diseases pages of iWheat.org are not affected by a change.
*/

class DiagKey_PlantDamage_Unregistered_TestCase extends FirstRemoteTestCase {
  public static function getInfo() {
    return array(
      'name' => 'Plant Damage Unregistered Test',
      'description' => 'Tests Plant Damage page when not logged in',
      'group' => 'iWheat',
    );
  }

  function setUp()
  {
    parent::setUp(array('node'));
  }
  function testBugsPresent()
  {
    module_enable(array('contact'));
    $this->resetAll();

    $this->drupalGet('/pests/plantkey');
    $this->Plant_damage_only_tab();
  }
  function Plant_damage_only_tab()
  {
  
    $base_url = variable_get('simpletest_remote_url', '');
    $base_url = $base_url ? $base_url : 'iwheat.org';
    $this->pass($base_url, 'base_url');
    
    //checks for the winter grain mite image
    $url = "http://$base_url/sites/default/files/styles/medium/public/WinterGrainMite.jpeg";
    $xpath = '//table[contains(@class,"views-table cols-2")]';
    $this->assertImage($xpath, $url, 0, 'Found image with full URL', $group = 'Special');
    $url = 'WinterGrainMite.jpeg';
    $this->assertImage($xpath, $url, 0, 'Found image with file name', $group = 'Special');

    //checks for the winter grain mite damage image
    $url = "http://$base_url/sites/default/files/styles/medium/public/WinterGrainMiteDamage.jpg";
    $xpath = '//table[contains(@class,"views-table cols-2")]';
    $this->assertImage($xpath, $url, 0, 'Found image with full URL', $group = 'Special');
    $url = 'WinterGrainMiteDamage.jpg';
    $this->assertImage($xpath, $url, 0, 'Found image with file name', $group = 'Special');     

    //checks for the white grub
    $url = "http://$base_url/sites/default/files/styles/medium/public/white_grub_073.png";
    $xpath = '//table[contains(@class,"views-table cols-2")]';
    $this->assertImage($xpath, $url, 0, 'Found image with full URL', $group = 'Special');
    $url = 'white_grub_073.png';
    $this->assertImage($xpath, $url, 0, 'Found image with file name', $group = 'Special');  

    //checks for the white grub damage
    $url = "http://$base_url/sites/default/files/styles/medium/public/wheat%20tillers%20damaged%20by%20white%20grub%20feeding.png";
    $xpath = '//table[contains(@class,"views-table cols-2")]';
    $this->assertImage($xpath, $url, 0, 'Found image with full URL', $group = 'Special');
    $url = 'wheat%20tillers%20damaged%20by%20white%20grub%20feeding.png';
    $this->assertImage($xpath, $url, 0, 'Found image with file name', $group = 'Special');  
  }
}

